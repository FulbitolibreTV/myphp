<?php// fluidplayer.php - Fluid Player Implementationheader('X-Frame-Options: SAMEORIGIN');header('Content-Type: text/html; charset=UTF-8');// Obtener parámetros$src = $_GET['src'] ?? '';$type = $_GET['type'] ?? 'mp4';$provider = $_GET['provider'] ?? 'direct';$autoplay = $_GET['autoplay'] ?? '0';$controls = $_GET['controls'] ?? '1';if (empty($src)) {    die('<div style="text-align:center;padding:50px;color:#fff;background:#000;">? No se proporcionó URL de video</div>');}// Función para procesar URLs según el proveedorfunction processVideoURL($src, $provider) {    switch ($provider) {        case 'gdrive':            if (strpos($src, 'drive.google.com') !== false) {                preg_match('/\/d\/([a-zA-Z0-9-_]+)/', $src, $matches);                $fileId = $matches[1] ?? $src;            } else {                $fileId = $src;            }            return "https://drive.google.com/uc?export=download&id=" . $fileId;                    case 'dropbox':            return str_replace(['?dl=0', '?dl=1'], '?dl=1', $src);                    case 'onedrive':            return str_replace('/view?', '/download?', $src);                    case 'mega':            // Para MEGA necesitarías implementar su API o usar enlaces directos            return $src;                    case 'yt':            // YouTube - extraer ID            $videoId = $src;            if (strpos($src, 'youtube.com') !== false || strpos($src, 'youtu.be') !== false) {                preg_match('/(?:youtube\.com\/watch\?v=|youtu\.be\/)([a-zA-Z0-9_-]+)/', $src, $matches);                $videoId = $matches[1] ?? $src;            }            return "https://www.youtube.com/watch?v=" . $videoId;                    case 'vimeo':            $videoId = $src;            if (strpos($src, 'vimeo.com') !== false) {                preg_match('/vimeo\.com\/(\d+)/', $src, $matches);                $videoId = $matches[1] ?? $src;            }            return "https://vimeo.com/" . $videoId;                    case 'dailymotion':            $videoId = $src;            if (strpos($src, 'dailymotion.com') !== false) {                preg_match('/dailymotion\.com\/video\/([a-zA-Z0-9]+)/', $src, $matches);                $videoId = $matches[1] ?? $src;            }            return "https://www.dailymotion.com/video/" . $videoId;                    case 'twitch':            return $src; // Twitch requiere manejo especial                    case 'facebook':            return $src; // Facebook requiere manejo especial                    case 'm3u8':        case 'rtmp':        case 'direct':        default:            return $src;    }}$processedSrc = processVideoURL($src, $provider);$videoId = 'fluidPlayer_' . uniqid();?><!DOCTYPE html><html lang="es"><head>    <meta charset="UTF-8">    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <title>Fluid Player</title>    <style>        * { margin: 0; padding: 0; box-sizing: border-box; }        body {             background: #000;             font-family: Arial, sans-serif;             display: flex;             justify-content: center;             align-items: center;             min-height: 100vh;         }        .player-container {             width: 100%;             max-width: 100%;             position: relative;         }        video {             width: 100%;             height: auto;             display: block;         }        .error-container {            background: #1a1a1a;            color: #ff6b6b;            padding: 40px 20px;            text-align: center;            border-radius: 8px;        }        .loading {            color: #fff;            text-align: center;            padding: 40px 20px;        }    </style>    <link rel="stylesheet" href="https://cdn.fluidplayer.com/v3/current/fluidplayer.min.css" type="text/css"/>    <script src="https://cdn.fluidplayer.com/v3/current/fluidplayer.min.js"></script></head><body>    <div class="player-container">        <?php if (in_array($provider, ['yt', 'vimeo', 'dailymotion'])): ?>            <!-- Para proveedores que requieren embed especial -->            <?php if ($provider === 'yt'): ?>                <div id="<?= $videoId ?>" class="loading">?? Cargando YouTube...</div>            <?php elseif ($provider === 'vimeo'): ?>                <div id="<?= $videoId ?>" class="loading">?? Cargando Vimeo...</div>            <?php else: ?>                <div id="<?= $videoId ?>" class="loading">?? Cargando video...</div>            <?php endif; ?>        <?php else: ?>            <!-- Video HTML5 estándar -->            <video id="<?= $videoId ?>" <?= $controls === '1' ? 'controls' : '' ?>>                <source src="<?= htmlspecialchars($processedSrc) ?>" type="video/<?= htmlspecialchars($type) ?>">                <div class="error-container">                    <h3>? Error al cargar el video</h3>                    <p>Tu navegador no soporta la reproducción de este video.</p>                </div>            </video>        <?php endif; ?>    </div>    <script>        document.addEventListener('DOMContentLoaded', function() {            const videoId = '<?= $videoId ?>';            const provider = '<?= $provider ?>';            const autoplay = <?= $autoplay === '1' ? 'true' : 'false' ?>;            const controls = <?= $controls === '1' ? 'true' : 'false' ?>;                        try {                let fluidPlayerConfig = {                    layoutControls: {                        fillToContainer: true,                        autoPlay: autoplay,                        mute: autoplay, // Mute si autoplay está activado                        allowTheatre: true,                        playButtonShowing: true,                        playPauseAnimation: true,                        controlBar: {                            autoHide: true,                            autoHideTimeout: 3,                            animated: true                        }                    }                };                // Configuraciones específicas por proveedor                switch (provider) {                    case 'yt':                        // YouTube requiere configuración especial                        fluidPlayerConfig.modules = {                            configureHls: false                        };                        break;                                            case 'm3u8':                        // HLS streaming                        fluidPlayerConfig.modules = {                            configureHls: {                                enableWorker: true                            }                        };                        break;                                            case 'rtmp':                        // RTMP streaming (requiere Flash o configuración especial)                        console.warn('RTMP requiere configuración adicional');                        break;                }                // Inicializar Fluid Player                const player = fluidPlayer(videoId, fluidPlayerConfig);                                // Eventos del player                player.on('ready', function() {                    console.log('Fluid Player listo');                });                                player.on('error', function(error) {                    console.error('Error en Fluid Player:', error);                    showError('Error al reproducir el video: ' + error.message);                });            } catch (error) {                console.error('Error inicializando Fluid Player:', error);                showError('Error al inicializar el reproductor');            }        });        function showError(message) {            document.querySelector('.player-container').innerHTML = `                <div class="error-container">                    <h3>? Error</h3>                    <p>${message}</p>                    <br>                    <p><strong>Proveedor:</strong> <?= ucfirst($provider) ?></p>                    <p><strong>Tipo:</strong> <?= strtoupper($type) ?></p>                    <br>                    <a href="<?= htmlspecialchars($processedSrc) ?>" target="_blank" style="color: #4fc3f7;">                        ?? Abrir enlace directo                    </a>                </div>            `;        }    </script></body></html>