<?php// jwplayer.php - JW Player Implementationheader('X-Frame-Options: SAMEORIGIN');header('Content-Type: text/html; charset=UTF-8');// Obtener parámetros$src = $_GET['src'] ?? '';$type = $_GET['type'] ?? 'mp4';$provider = $_GET['provider'] ?? 'direct';$autoplay = $_GET['autoplay'] ?? '0';$controls = $_GET['controls'] ?? '1';if (empty($src)) {    die('<div style="text-align:center;padding:50px;color:#fff;background:#000;">? No se proporcionó URL de video</div>');}// Función para procesar URLs según el proveedorfunction processVideoURL($src, $provider) {    switch ($provider) {        case 'gdrive':            if (strpos($src, 'drive.google.com') !== false) {                preg_match('/\/d\/([a-zA-Z0-9-_]+)/', $src, $matches);                $fileId = $matches[1] ?? $src;            } else {                $fileId = $src;            }            return "https://drive.google.com/uc?export=download&id=" . $fileId;                    case 'dropbox':            return str_replace(['?dl=0', '?dl=1'], '?dl=1', $src);                    case 'onedrive':            return str_replace('/view?', '/download?', $src);                    case 'yt':            $videoId = $src;            if (strpos($src, 'youtube.com') !== false || strpos($src, 'youtu.be') !== false) {                preg_match('/(?:youtube\.com\/watch\?v=|youtu\.be\/)([a-zA-Z0-9_-]+)/', $src, $matches);                $videoId = $matches[1] ?? $src;            }            return $videoId; // JWPlayer maneja YouTube diferente                    case 'vimeo':            $videoId = $src;            if (strpos($src, 'vimeo.com') !== false) {                preg_match('/vimeo\.com\/(\d+)/', $src, $matches);                $videoId = $matches[1] ?? $src;            }            return $videoId;                    case 'dailymotion':            $videoId = $src;            if (strpos($src, 'dailymotion.com') !== false) {                preg_match('/dailymotion\.com\/video\/([a-zA-Z0-9]+)/', $src, $matches);                $videoId = $matches[1] ?? $src;            }            return $videoId;                    default:            return $src;    }}$processedSrc = processVideoURL($src, $provider);$playerId = 'jwplayer_' . uniqid();?><!DOCTYPE html><html lang="es"><head>    <meta charset="UTF-8">    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <title>JW Player</title>    <style>        * { margin: 0; padding: 0; box-sizing: border-box; }        body {             background: #000;             font-family: Arial, sans-serif;             display: flex;             justify-content: center;             align-items: center;             min-height: 100vh;         }        .player-container {             width: 100%;             max-width: 100%;             position: relative;         }        #<?= $playerId ?> {            width: 100% !important;            height: 400px !important;        }        .error-container {            background: #1a1a1a;            color: #ff6b6b;            padding: 40px 20px;            text-align: center;            border-radius: 8px;        }        .loading {            color: #fff;            text-align: center;            padding: 40px 20px;        }    </style>    <!-- JW Player CDN -->    <script src="https://cdn.jwplayer.com/libraries/Nv6xEKHF.js"></script></head><body>    <div class="player-container">        <div id="<?= $playerId ?>">            <div class="loading">?? Cargando JW Player...</div>        </div>    </div>    <script>        document.addEventListener('DOMContentLoaded', function() {            const playerId = '<?= $playerId ?>';            const provider = '<?= $provider ?>';            const processedSrc = '<?= addslashes($processedSrc) ?>';            const type = '<?= $type ?>';            const autoplay = <?= $autoplay === '1' ? 'true' : 'false' ?>;            const controls = <?= $controls === '1' ? 'true' : 'false' ?>;                        try {                let playerConfig = {                    autostart: autoplay,                    controls: controls,                    displaydescription: true,                    displaytitle: true,                    skin: 'roundster',                    stretching: 'responsive',                    width: '100%',                    height: '400px'                };                // Configurar fuente según el proveedor                switch (provider) {                    case 'yt':                        // YouTube                        playerConfig.file = `https://www.youtube.com/watch?v=${processedSrc}`;                        break;                                            case 'vimeo':                        // Vimeo                        playerConfig.file = `https://vimeo.com/${processedSrc}`;                        break;                                            case 'dailymotion':                        // Dailymotion                        playerConfig.file = `https://www.dailymotion.com/video/${processedSrc}`;                        break;                                            case 'twitch':                        // Twitch (requiere configuración especial)                        playerConfig.file = processedSrc;                        break;                                            case 'm3u8':                        // HLS streaming                        playerConfig.file = processedSrc;                        playerConfig.type = 'hls';                        break;                                            case 'rtmp':                        // RTMP streaming                        playerConfig.file = processedSrc;                        playerConfig.type = 'rtmp';                        break;                                            default:                        // Archivo directo                        playerConfig.sources = [{                            file: processedSrc,                            type: type === 'mp4' ? 'video/mp4' :                                   type === 'webm' ? 'video/webm' :                                   type === 'ogg' ? 'video/ogg' :                                   `video/${type}`                        }];                        break;                }                // Inicializar JW Player                const player = jwplayer(playerId).setup(playerConfig);                                // Eventos del player                player.on('ready', function() {                    console.log('JW Player listo');                });                                player.on('error', function(error) {                    console.error('Error en JW Player:', error);                    showError('Error al reproducir el video: ' + error.message);                });                player.on('setupError', function(error) {                    console.error('Error de configuración JW Player:', error);                    showError('Error de configuración del reproductor');                });            } catch (error) {                console.error('Error inicializando JW Player:', error);                showError('Error al inicializar JW Player');            }        });        function showError(message) {            document.getElementById('<?= $playerId ?>').innerHTML = `                <div class="error-container">                    <h3>? Error JW Player</h3>                    <p>${message}</p>                    <br>                    <p><strong>Proveedor:</strong> <?= ucfirst($provider) ?></p>                    <p><strong>Tipo:</strong> <?= strtoupper($type) ?></p>                    <p><strong>URL:</strong> <?= htmlspecialchars($processedSrc) ?></p>                    <br>                    <a href="<?= htmlspecialchars($processedSrc) ?>" target="_blank" style="color: #4fc3f7;">                        ?? Abrir enlace directo                    </a>                </div>            `;        }    </script></body></html>