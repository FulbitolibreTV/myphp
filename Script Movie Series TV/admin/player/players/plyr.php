<?php// plyr.php - Plyr.io Player Implementationheader('X-Frame-Options: SAMEORIGIN');header('Content-Type: text/html; charset=UTF-8');// Obtener parámetros$src = $_GET['src'] ?? '';$type = $_GET['type'] ?? 'mp4';$provider = $_GET['provider'] ?? 'direct';$autoplay = $_GET['autoplay'] ?? '0';$controls = $_GET['controls'] ?? '1';if (empty($src)) {    die('<div style="text-align:center;padding:50px;color:#fff;background:#000;">? No se proporcionó URL de video</div>');}// Función para procesar URLs según el proveedorfunction processVideoURL($src, $provider) {    switch ($provider) {        case 'gdrive':            if (strpos($src, 'drive.google.com') !== false) {                preg_match('/\/d\/([a-zA-Z0-9-_]+)/', $src, $matches);                $fileId = $matches[1] ?? $src;            } else {                $fileId = $src;            }            return "https://drive.google.com/uc?export=download&id=" . $fileId;                    case 'dropbox':            return str_replace(['?dl=0', '?dl=1'], '?dl=1', $src);                    case 'onedrive':            return str_replace('/view?', '/download?', $src);                    case 'yt':            $videoId = $src;            if (strpos($src, 'youtube.com') !== false || strpos($src, 'youtu.be') !== false) {                preg_match('/(?:youtube\.com\/watch\?v=|youtu\.be\/)([a-zA-Z0-9_-]+)/', $src, $matches);                $videoId = $matches[1] ?? $src;            }            return $videoId;                    case 'vimeo':            $videoId = $src;            if (strpos($src, 'vimeo.com') !== false) {                preg_match('/vimeo\.com\/(\d+)/', $src, $matches);                $videoId = $matches[1] ?? $src;            }            return $videoId;                    default:            return $src;    }}$processedSrc = processVideoURL($src, $provider);$playerId = 'plyr_' . uniqid();?><!DOCTYPE html><html lang="es"><head>    <meta charset="UTF-8">    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <title>Plyr Player</title>    <style>        * { margin: 0; padding: 0; box-sizing: border-box; }        body {             background: #000;             font-family: Arial, sans-serif;             display: flex;             justify-content: center;             align-items: center;             min-height: 100vh;         }        .player-container {             width: 100%;             max-width: 100%;             position: relative;         }        video, .plyr__video-embed {            width: 100%;            height: auto;        }        .error-container {            background: #1a1a1a;            color: #ff6b6b;            padding: 40px 20px;            text-align: center;            border-radius: 8px;        }        .loading {            color: #fff;            text-align: center;            padding: 40px 20px;        }                /* Personalización de Plyr */        .plyr {            border-radius: 8px;            overflow: hidden;        }                .plyr__control--overlaid {            background: rgba(0, 174, 255, 0.8);        }                .plyr__control--overlaid:hover {            background: rgba(0, 174, 255, 1);        }    </style>    <!-- Plyr.io CSS -->    <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />    <!-- Plyr.io JS -->    <script src="https://cdn.plyr.io/3.7.8/plyr.polyfilled.js"></script></head><body>    <div class="player-container">        <?php if ($provider === 'yt'): ?>            <!-- YouTube Embed -->            <div id="<?= $playerId ?>" data-plyr-provider="youtube" data-plyr-embed-id="<?= htmlspecialchars($processedSrc) ?>"></div>        <?php elseif ($provider === 'vimeo'): ?>            <!-- Vimeo Embed -->            <div id="<?= $playerId ?>" data-plyr-provider="vimeo" data-plyr-embed-id="<?= htmlspecialchars($processedSrc) ?>"></div>        <?php else: ?>            <!-- HTML5 Video -->            <video id="<?= $playerId ?>" playsinline <?= $controls === '1' ? 'controls' : '' ?>>                <source src="<?= htmlspecialchars($processedSrc) ?>" type="video/<?= htmlspecialchars($type) ?>" />                <div class="error-container">                    <h3>? Error al cargar el video</h3>                    <p>Tu navegador no soporta la reproducción de este video.</p>                </div>            </video>        <?php endif; ?>    </div>    <script>        document.addEventListener('DOMContentLoaded', function() {            const playerId = '<?= $playerId ?>';            const provider = '<?= $provider ?>';            const autoplay = <?= $autoplay === '1' ? 'true' : 'false' ?>;            const controls = <?= $controls === '1' ? 'true' : 'false' ?>;                        try {                // Configuración de Plyr                const plyrConfig = {                    // Controles                    controls: controls ? [                        'play-large',                        'restart',                        'rewind',                        'play',                        'fast-forward',                        'progress',                        'current-time',                        'duration',                        'mute',                        'volume',                        'captions',                        'settings',                        'pip',                        'airplay',                        'fullscreen'                    ] : [],                                        // Configuraciones generales                    autoplay: autoplay,                    muted: autoplay, // Mute si autoplay está activado                    clickToPlay: true,                    keyboard: { focused: true, global: false },                    tooltips: { controls: true, seek: true },                                        // Configuraciones de video                    ratio: '16:9',                    fullscreen: { enabled: true, fallback: true, iosNative: true },                                        // Configuraciones por proveedor                    youtube: {                        noCookie: false,                        rel: 0,                        showinfo: 0,                        iv_load_policy: 3,                        modestbranding: 1                    },                                        vimeo: {                        byline: false,                        portrait: false,                        title: false,                        speed: true,                        transparent: false                    },                                        // Velocidades de reproducción                    speed: { selected: 1, options: [0.5, 0.75, 1, 1.25, 1.5, 1.75, 2] },                                        // Calidad (para providers que lo soporten)                    quality: { default: 576, options: [144, 240, 360, 480, 576, 720, 1080] }                };                // Inicializar Plyr                const player = new Plyr(`#${playerId}`, plyrConfig);                                // Eventos del player                player.on('ready', () => {                    console.log('Plyr Player listo');                                        // Si autoplay está activado                    if (autoplay && player.muted) {                        player.play().catch(e => {                            console.log('Autoplay falló:', e);                        });                    }                });                                player.on('error', (event) => {                    console.error('Error en Plyr:', event);                    showError('Error al reproducir el video');                });                player.on('loadstart', () => {                    console.log('Iniciando carga del video');                });                player.on('canplay', () => {                    console.log('Video listo para reproducir');                });                // Manejar errores específicos de providers externos                if (provider === 'yt' || provider === 'vimeo') {                    player.on('enterfullscreen', () => {                        console.log('Modo pantalla completa activado');                    });                                        player.on('exitfullscreen', () => {                        console.log('Modo pantalla completa desactivado');                    });                }            } catch (error) {                console.error('Error inicializando Plyr:', error);                showError('Error al inicializar el reproductor Plyr');            }        });        function showError(message) {            document.querySelector('.player-container').innerHTML = `                <div class="error-container">                    <h3>? Error Plyr Player</h3>                    <p>${message}</p>                    <br>                    <p><strong>Proveedor:</strong> <?= ucfirst($provider) ?></p>                    <p><strong>Tipo:</strong> <?= strtoupper($type) ?></p>                    <p><strong>URL:</strong> <?= htmlspecialchars($processedSrc) ?></p>                    <br>                    <a href="<?= htmlspecialchars($processedSrc) ?>" target="_blank" style="color: #4fc3f7;">                        ?? Abrir enlace directo                    </a>                </div>            `;        }    </script></body></html>