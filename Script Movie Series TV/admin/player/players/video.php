<?php// Obtener par¨¢metros de la URL$src = $_GET['src'] ?? '';$type = $_GET['type'] ?? 'mp4';$provider = $_GET['provider'] ?? 'direct';$autoplay = $_GET['autoplay'] ?? '0';$controls = $_GET['controls'] ?? '1';// Validar que tengamos una fuenteif (empty($src)) {    die('<div style="text-align:center;padding:50px;color:#666;">? No se proporcion¨® URL de video</div>');}// Procesar URL seg¨²n el proveedorfunction processVideoURL($src, $provider, $type) {    switch ($provider) {        case 'gdrive':            // Convertir ID de Google Drive a enlace directo            if (strpos($src, 'drive.google.com') !== false) {                preg_match('/\/d\/([a-zA-Z0-9-_]+)/', $src, $matches);                $fileId = $matches[1] ?? $src;            } else {                $fileId = $src;            }            return "https://drive.google.com/uc?export=download&id=" . $fileId;                    case 'dropbox':            // Convertir enlace de Dropbox a descarga directa            return str_replace('?dl=0', '?dl=1', $src);                    case 'onedrive':            // Para OneDrive, cambiar 'view' por 'download'            return str_replace('/view?', '/download?', $src);                    case 'yt':            // Para YouTube necesitar¨ªas usar la API o un extractor            return "https://www.youtube.com/embed/" . $src;                    case 'vimeo':            return "https://player.vimeo.com/video/" . $src;                    case 'direct':        default:            return $src;    }}$processedSrc = processVideoURL($src, $provider, $type);// Determinar el tipo MIMEfunction getMimeType($type) {    $mimeTypes = [        'mp4' => 'video/mp4',        'webm' => 'video/webm',        'ogg' => 'video/ogg',        'm3u8' => 'application/x-mpegURL',        'mpd' => 'application/dash+xml',        'flv' => 'video/x-flv',        'avi' => 'video/x-msvideo',        'mov' => 'video/quicktime',        'mkv' => 'video/x-matroska'    ];        return $mimeTypes[$type] ?? 'video/mp4';}$mimeType = getMimeType($type);?><!DOCTYPE html><html lang="es"><head>    <meta charset="UTF-8">    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <title>Video Player</title>    <style>        * {            margin: 0;            padding: 0;            box-sizing: border-box;        }                body {            background: #000;            font-family: Arial, sans-serif;            display: flex;            justify-content: center;            align-items: center;            min-height: 100vh;        }                .video-container {            position: relative;            width: 100%;            max-width: 100%;            background: #000;        }                video {            width: 100%;            height: auto;            display: block;            outline: none;        }                .error-message {            color: #ff6b6b;            text-align: center;            padding: 40px 20px;            background: #1a1a1a;            border-radius: 8px;            margin: 20px;        }                .loading {            color: #fff;            text-align: center;            padding: 40px 20px;        }                .video-info {            position: absolute;            top: 10px;            right: 10px;            background: rgba(0,0,0,0.7);            color: white;            padding: 5px 10px;            border-radius: 4px;            font-size: 12px;            display: none;        }                .video-container:hover .video-info {            display: block;        }    </style></head><body>    <div class="video-container">        <?php if ($provider === 'yt'): ?>            <!-- YouTube embed -->            <iframe                 width="100%"                 height="400"                 src="https://www.youtube.com/embed/<?= htmlspecialchars($src) ?>?autoplay=<?= $autoplay ?>&controls=<?= $controls ?>"                 frameborder="0"                 allowfullscreen>            </iframe>        <?php elseif ($provider === 'vimeo'): ?>            <!-- Vimeo embed -->            <iframe                 src="https://player.vimeo.com/video/<?= htmlspecialchars($src) ?>?autoplay=<?= $autoplay ?>"                 width="100%"                 height="400"                 frameborder="0"                 allowfullscreen>            </iframe>        <?php else: ?>            <!-- HTML5 Video Player -->            <video                 id="videoPlayer"                <?= $controls === '1' ? 'controls' : '' ?>                <?= $autoplay === '1' ? 'autoplay muted' : '' ?>                preload="metadata"                playsinline                onloadstart="showLoading()"                oncanplay="hideLoading()"                onerror="showError()"            >                <source src="<?= htmlspecialchars($processedSrc) ?>" type="<?= $mimeType ?>">                <p class="error-message">                    Tu navegador no soporta la reproducci¨®n de video HTML5.                    <br><br>                    <a href="<?= htmlspecialchars($processedSrc) ?>" style="color: #4fc3f7;">                        Descargar video                    </a>                </p>            </video>                        <div class="video-info">                <?= strtoupper($type) ?> ? <?= ucfirst($provider) ?>            </div>                        <div id="loading" class="loading" style="display: none;">                ?? Cargando video...            </div>        <?php endif; ?>    </div>    <script>        function showLoading() {            document.getElementById('loading').style.display = 'block';        }                function hideLoading() {            document.getElementById('loading').style.display = 'none';        }                function showError() {            const video = document.getElementById('videoPlayer');            const container = document.querySelector('.video-container');                        container.innerHTML = `                <div class="error-message">                    <h3>? Error al cargar el video</h3>                    <p>No se pudo reproducir el archivo de video.</p>                    <br>                    <p><strong>URL:</strong> <?= htmlspecialchars($processedSrc) ?></p>                    <p><strong>Tipo:</strong> <?= $mimeType ?></p>                    <p><strong>Proveedor:</strong> <?= ucfirst($provider) ?></p>                    <br>                    <a href="<?= htmlspecialchars($processedSrc) ?>" target="_blank" style="color: #4fc3f7;">                        ?? Abrir enlace directo                    </a>                </div>            `;        }                // Manejar errores de CORS        window.addEventListener('error', function(e) {            if (e.message.includes('CORS')) {                showError();            }        });                // Para HLS (M3U8)        <?php if ($type === 'm3u8'): ?>        if (Hls.isSupported()) {            const video = document.getElementById('videoPlayer');            const hls = new Hls();            hls.loadSource('<?= htmlspecialchars($processedSrc) ?>');            hls.attachMedia(video);        }        <?php endif; ?>    </script>        <?php if ($type === 'm3u8'): ?>    <!-- HLS.js para streaming M3U8 -->    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>    <?php endif; ?></body></html>